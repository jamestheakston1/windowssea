<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 11 Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: 'Segoe UI Variable Display', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
        }

        .desktop {
            background-image: url('https://4kwallpapers.com/images/wallpapers/windows-11-blue-stock-white-background-light-official-3840x2160-5616.jpg');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100vw;
            position: relative;
            transition: background 0.5s ease;
        }

        .desktop.dark-mode {
            background-image: url('https://images.hdqwalls.com/download/windows-11-dark-mode-4k-4q-3840x2160.jpg');
        }

        .taskbar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 48px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 12px;
            z-index: 1000;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .dark-mode .taskbar {
            background: rgba(28, 28, 28, 0.85);
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .taskbar.left-aligned {
            justify-content: flex-start;
            padding-left: 12px;
        }

        .taskbar-right {
            position: absolute;
            right: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .window {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            display: none;
            opacity: 0;
            flex-direction: column;
            overflow: hidden;
            z-index: 100;
            border: 1px solid rgba(0,0,0,0.1);
            transform: scale(0.95) translateY(10px);
            transition: transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1), opacity 0.2s ease-out;
            pointer-events: none;
            min-width: 300px;
            min-height: 200px;
        }

        .dark-mode .window {
            background: rgba(32, 32, 32, 0.9);
            color: white;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .window.active {
            display: flex;
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: auto;
        }

        .window.no-blur {
            backdrop-filter: none;
            background: white;
        }

        .dark-mode .window.no-blur {
            background: #1e1e1e;
        }

        .resizer {
            width: 15px;
            height: 15px;
            background: transparent;
            position: absolute;
            right: 0;
            bottom: 0;
            cursor: nwse-resize;
            z-index: 101;
        }

        #start-menu {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%) translateY(30px);
            width: 520px;
            height: 580px;
            background: rgba(243, 243, 243, 0.85);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 8px;
            z-index: 900;
            display: none;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.1, 0.9, 0.2, 1);
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }

        .dark-mode #start-menu {
            background: rgba(32, 32, 32, 0.85);
            color: white;
            border: 1px solid rgba(255,255,255,0.1);
        }

        #start-menu.active {
            display: flex;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        #user-dropdown {
            position: absolute;
            bottom: 50px;
            left: 10px;
            width: 220px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 1100;
            display: none;
            border: 1px solid rgba(0,0,0,0.1);
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #user-dropdown.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .dark-mode #user-dropdown {
            background: #2b2b2b;
            color: white;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .taskbar-btn { 
            padding: 6px 8px; 
            border-radius: 4px; 
            transition: all 0.2s; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
        }
        .taskbar-btn:hover { background: rgba(255,255,255,0.5); transform: translateY(-2px); }
        .taskbar-btn.open::after { 
            content: ''; 
            position: absolute; 
            bottom: 2px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 6px; 
            height: 3px; 
            background: #0067c0; 
            border-radius: 10px; 
        }

        .toggle-switch {
            width: 40px;
            height: 20px;
            background: #ccc;
            border-radius: 20px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }
        .toggle-switch.on { background: #0067c0; }
        .toggle-switch::before {
            content: '';
            position: absolute;
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: left 0.3s;
        }
        .toggle-switch.on::before { left: 23px; }

        #security-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 50, 100, 0.95);
            backdrop-filter: blur(50px);
            z-index: 5000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #security-menu.active {
            display: flex;
            opacity: 1;
        }

        .security-item {
            cursor: pointer;
            transition: all 0.2s;
            padding: 8px 16px;
            border-radius: 4px;
            width: 300px;
            text-align: center;
        }
        .security-item:hover {
            background: rgba(255,255,255,0.1);
            color: #93c5fd;
        }

        #browser-home {
            background: radial-gradient(circle at center, #ffffff 0%, #f3f3f3 100%);
        }
        .dark-mode #browser-home {
            background: radial-gradient(circle at center, #2c2c2c 0%, #1e1e1e 100%);
        }
    </style>
</head>
<body class="bg-black">

    <div id="security-menu">
        <div class="flex flex-col gap-2 text-2xl font-light">
            <div class="security-item" onclick="handleSecurityAction()">Lock</div>
            <div class="security-item" onclick="handleSecurityAction()">Switch user</div>
            <div class="security-item" onclick="handleSecurityAction()">Sign out</div>
            <div class="security-item" onclick="handleSecurityAction()">Change a password</div>
            <div class="security-item" onclick="openApp('taskmgr'); closeSecurity()">Task Manager</div>
        </div>
        <button onclick="closeSecurity()" class="absolute bottom-12 right-12 bg-white/10 p-4 rounded hover:bg-white/20 transition-all active:scale-95">Cancel</button>
    </div>

    <div id="error-dialog" class="fixed inset-0 bg-black/20 z-[6000] hidden justify-center items-center backdrop-blur-sm">
        <div class="bg-white rounded-lg shadow-2xl w-[400px] overflow-hidden flex flex-col border border-gray-300 scale-90 opacity-0 transition-all duration-300" id="error-box">
            <div class="flex justify-between items-center px-4 py-2 border-b bg-gray-50">
                <span class="text-xs font-medium text-gray-700">Windows Security</span>
                <button onclick="closeError()" class="text-gray-400 hover:text-black">✕</button>
            </div>
            <div class="p-6 flex gap-4 items-start text-black">
                <div class="bg-red-100 p-2 rounded-full"><i data-feather="slash" class="text-red-600 w-5 h-5"></i></div>
                <p class="text-sm font-medium" id="error-message">This action has been blocked by your administrator.</p>
            </div>
            <div class="bg-gray-50 p-3 flex justify-end">
                <button onclick="closeError()" class="bg-blue-600 text-white px-8 py-1 rounded text-xs hover:bg-blue-700 active:scale-95 transition-all">OK</button>
            </div>
        </div>
    </div>

    <div id="start-menu">
        <div class="p-8 flex-grow">
            <div class="relative mb-6">
                <input type="text" placeholder="Search for apps, settings, and documents" class="w-full bg-white dark:bg-zinc-800 border-b-2 border-blue-500 p-2 pl-10 text-xs rounded-t shadow-sm outline-none">
                <i data-feather="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-400"></i>
            </div>
            
            <div class="grid grid-cols-4 gap-4 text-center">
                <div class="flex flex-col items-center gap-1 cursor-pointer group" onclick="openApp('browser'); toggleStart()">
                    <div class="p-3 rounded-lg group-hover:bg-white/10 transition-colors"><i data-feather="globe" class="text-blue-500 w-7 h-7"></i></div>
                    <span class="text-[10px]">Edge</span>
                </div>
                <div class="flex flex-col items-center gap-1 cursor-pointer group" onclick="openApp('wikipedia'); toggleStart()">
                    <div class="p-3 rounded-lg group-hover:bg-white/10 transition-colors"><i data-feather="book-open" class="text-white w-7 h-7"></i></div>
                    <span class="text-[10px]">Wikipedia</span>
                </div>
                <div class="flex flex-col items-center gap-1 cursor-pointer group" onclick="openApp('settings'); toggleStart()">
                    <div class="p-3 rounded-lg group-hover:bg-white/10 transition-colors"><i data-feather="settings" class="text-gray-400 w-7 h-7"></i></div>
                    <span class="text-[10px]">Settings</span>
                </div>
                <div class="flex flex-col items-center gap-1 cursor-pointer group" onclick="openApp('cmd'); toggleStart()">
                    <div class="p-3 rounded-lg group-hover:bg-white/10 transition-colors"><i data-feather="terminal" class="text-zinc-400 w-7 h-7"></i></div>
                    <span class="text-[10px]">Terminal</span>
                </div>
                <div class="flex flex-col items-center gap-1 cursor-pointer group" onclick="openApp('wellbeing'); toggleStart()">
                    <div class="p-3 rounded-lg group-hover:bg-white/10 transition-colors"><i data-feather="heart" class="text-pink-400 w-7 h-7"></i></div>
                    <span class="text-[10px]">Wellbeing</span>
                </div>
            </div>
        </div>

        <div class="mt-auto px-10 py-4 border-t border-black/5 flex justify-between items-center bg-white/5 relative">
            <div id="user-dropdown" class="p-1">
                <div class="p-2 text-xs hover:bg-black/5 dark:hover:bg-white/5 cursor-pointer rounded flex items-center gap-2" onclick="showSecurity(); toggleUserDropdown()">
                    <i data-feather="shield" class="w-4 h-4"></i> Open Security Menu
                </div>
                <div class="p-2 text-xs hover:bg-black/5 dark:hover:bg-white/5 cursor-pointer rounded flex items-center gap-2" onclick="handleLogout()">
                    <i data-feather="log-out" class="w-4 h-4"></i> Logout
                </div>
            </div>
            <div class="flex items-center gap-3 cursor-pointer hover:bg-white/10 p-1 px-2 rounded transition-all active:scale-95" onclick="toggleUserDropdown(event)">
                <div class="w-7 h-7 bg-blue-600 rounded-full flex items-center justify-center text-white text-[10px] font-bold">JD</div>
                <span class="text-xs font-medium">John Doe</span>
            </div>
            <i data-feather="power" class="w-4 h-4 text-gray-400 cursor-pointer hover:text-blue-600" onclick="showError()"></i>
        </div>
    </div>

    <div class="desktop" id="main-desktop" onclick="handleDesktopClick(event)">
        <div class="p-4 grid grid-flow-col grid-rows-8 gap-2 w-fit">
            <div class="flex flex-col items-center p-2 rounded hover:bg-white/10 cursor-pointer w-20 group" onclick="openApp('browser')">
                <i data-feather="globe" class="text-blue-400 w-8 h-8 group-hover:scale-110 transition-transform"></i>
                <span class="text-[11px] text-white mt-1 drop-shadow-md">Edge</span>
            </div>
            <div class="flex flex-col items-center p-2 rounded hover:bg-white/10 cursor-pointer w-20 group" onclick="openApp('wikipedia')">
                <i data-feather="book-open" class="text-white w-8 h-8 group-hover:scale-110 transition-transform"></i>
                <span class="text-[11px] text-white mt-1 drop-shadow-md">Wikipedia</span>
            </div>
            <div class="flex flex-col items-center p-2 rounded hover:bg-white/10 cursor-pointer w-20 group" onclick="openApp('wellbeing')">
                <i data-feather="heart" class="text-pink-400 w-8 h-8 group-hover:scale-110 transition-transform"></i>
                <span class="text-[11px] text-white mt-1 drop-shadow-md">Wellbeing</span>
            </div>
        </div>

        <div id="win-browser" class="window no-blur" style="width: 900px; height: 600px;" data-app="browser">
            <div class="win-titlebar bg-gray-100 dark:bg-zinc-800 p-2 flex justify-between items-center border-b border-black/5" onmousedown="dragElement(this.parentElement, event)">
                <div class="flex items-center gap-2 text-xs"><i data-feather="globe" class="w-3 h-3 text-blue-500"></i><span>Microsoft Edge</span></div>
                <div class="flex gap-2">
                    <button class="px-2 hover:bg-black/5">_</button>
                    <button onclick="closeWin('win-browser')" class="px-2 hover:bg-red-500 hover:text-white">✕</button>
                </div>
            </div>
            <div class="bg-gray-50 dark:bg-zinc-900 p-2 flex gap-2 items-center">
                <div class="flex gap-2 px-2">
                    <i data-feather="arrow-left" class="w-4 h-4 text-gray-400"></i>
                    <i data-feather="arrow-right" class="w-4 h-4 text-gray-400"></i>
                    <i data-feather="rotate-cw" class="w-4 h-4 text-gray-600 cursor-pointer" onclick="refreshIframe('browser-frame')"></i>
                </div>
                <input type="text" id="browser-url" placeholder="Search or enter web address" class="flex-grow bg-white dark:bg-zinc-800 border rounded-full px-4 py-1 text-xs outline-none focus:ring-1 ring-blue-500" onkeydown="handleUrlGo(event, 'browser-frame')">
                <i data-feather="star" class="w-4 h-4 text-gray-400 mr-2"></i>
            </div>
            <div class="flex-grow relative overflow-hidden">
                <div id="browser-home" class="absolute inset-0 flex flex-col items-center justify-center z-10">
                    <div class="flex items-center gap-4 mb-8">
                        <i data-feather="layers" class="w-12 h-12 text-blue-500"></i>
                        <h1 class="text-4xl font-bold tracking-tight">WindowsSea</h1>
                    </div>
                    <div class="w-[500px] relative">
                        <input type="text" id="home-search" placeholder="Search the web..." class="w-full p-4 pl-12 rounded-full border shadow-lg outline-none focus:ring-2 ring-blue-500 dark:bg-zinc-800 dark:border-zinc-700" onkeydown="handleUrlGo(event, 'browser-frame')">
                        <i data-feather="search" class="absolute left-4 top-4.5 text-gray-400"></i>
                    </div>
                    <p class="mt-6 text-sm text-gray-500">Fast, secure, and built for you.</p>
                </div>
                <iframe id="browser-frame" class="w-full h-full border-none hidden"></iframe>
            </div>
            <div class="resizer" onmousedown="initResize(this.parentElement, event)"></div>
        </div>

        <div id="win-wikipedia" class="window no-blur" style="width: 850px; height: 650px;" data-app="wikipedia">
            <div class="win-titlebar bg-gray-100 dark:bg-zinc-800 p-2 flex justify-between items-center border-b border-black/5" onmousedown="dragElement(this.parentElement, event)">
                <div class="flex items-center gap-2 text-xs"><i data-feather="book-open" class="w-3 h-3 text-gray-600"></i><span>Wikipedia</span></div>
                <button onclick="closeWin('win-wikipedia')" class="px-2 hover:bg-red-500 hover:text-white">✕</button>
            </div>
            <iframe src="https://en.m.wikipedia.org" class="flex-grow w-full border-none"></iframe>
            <div class="resizer" onmousedown="initResize(this.parentElement, event)"></div>
        </div>

        <div id="win-wellbeing" class="window no-blur" style="width: 600px; height: 450px;" data-app="wellbeing">
            <div class="win-titlebar bg-pink-50 dark:bg-zinc-800 p-2 flex justify-between items-center border-b border-black/5" onmousedown="dragElement(this.parentElement, event)">
                <div class="flex items-center gap-2 text-xs text-pink-600 font-semibold"><i data-feather="heart" class="w-3 h-3"></i><span>Digital Wellbeing</span></div>
                <button onclick="closeWin('win-wellbeing')" class="px-2 hover:bg-red-500 hover:text-white">✕</button>
            </div>
            <div class="p-8 space-y-6">
                <h3 class="text-xl font-bold">Your Screen Time</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-100 dark:bg-white/5 p-4 rounded-xl">
                        <div class="text-xs text-gray-500">Today</div>
                        <div class="text-2xl font-bold">4h 12m</div>
                    </div>
                    <div class="bg-gray-100 dark:bg-white/5 p-4 rounded-xl">
                        <div class="text-xs text-gray-500">Pickups</div>
                        <div class="text-2xl font-bold">28</div>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm"><span>Microsoft Edge</span><span class="font-semibold">2h 45m</span></div>
                    <div class="w-full bg-gray-200 dark:bg-white/10 h-1.5 rounded-full"><div class="bg-blue-500 h-full w-[65%] rounded-full"></div></div>
                    <div class="flex justify-between text-sm"><span>Terminal</span><span class="font-semibold">52m</span></div>
                    <div class="w-full bg-gray-200 dark:bg-white/10 h-1.5 rounded-full"><div class="bg-zinc-500 h-full w-[25%] rounded-full"></div></div>
                </div>
                <button class="w-full py-2 bg-pink-500 text-white rounded-lg text-sm font-medium hover:bg-pink-600 transition-colors" onclick="showError()">Set App Limits</button>
            </div>
            <div class="resizer" onmousedown="initResize(this.parentElement, event)"></div>
        </div>

        <div id="win-settings" class="window" style="width: 700px; height: 500px;" data-app="settings">
            <div class="flex h-full">
                <aside class="w-48 bg-black/5 border-r border-black/5 p-4 space-y-2">
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">System</div>
                    <div class="text-xs p-2 bg-white dark:bg-white/10 rounded shadow-sm flex items-center gap-2 cursor-pointer"><i data-feather="monitor" class="w-3 h-3"></i> Display</div>
                    <div class="text-xs p-2 hover:bg-white/5 rounded flex items-center gap-2 cursor-pointer" onclick="showError()"><i data-feather="zap" class="w-3 h-3"></i> Power</div>
                </aside>
                <div class="flex-grow flex flex-col">
                    <div class="win-titlebar p-3 flex justify-between items-center" onmousedown="dragElement(this.parentElement.parentElement, event)">
                        <span class="text-xs font-semibold">Settings</span>
                        <button onclick="closeWin('win-settings')" class="hover:text-red-500">✕</button>
                    </div>
                    <div class="p-6 space-y-6 overflow-y-auto">
                        <h2 class="text-xl font-semibold">System Parameters</h2>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-white/50 dark:bg-white/5 rounded border border-black/5">
                                <div>
                                    <div class="text-sm font-medium">Transparency Effects</div>
                                    <div class="text-[10px] text-gray-500">Windows and surfaces appear translucent</div>
                                </div>
                                <div class="toggle-switch on" id="param-transparency" onclick="toggleParam('transparency')"></div>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-white/50 dark:bg-white/5 rounded border border-black/5">
                                <div>
                                    <div class="text-sm font-medium">Taskbar Alignment</div>
                                    <div class="text-[10px] text-gray-500">Move icons to the left or center</div>
                                </div>
                                <button class="text-xs border border-black/10 px-3 py-1 rounded hover:bg-white/10" id="param-alignment" onclick="toggleParam('alignment')">Center</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="resizer" onmousedown="initResize(this.parentElement, event)"></div>
        </div>

        <div id="win-cmd" class="window no-blur" style="width: 600px; height: 400px; background: #0c0c0c; color: #ccc;" data-app="cmd">
            <div class="win-titlebar flex justify-between items-center px-4 py-2 border-b border-gray-800" onmousedown="dragElement(this.parentElement, event)">
                <div class="flex items-center gap-2 text-xs text-gray-400"><i data-feather="terminal" class="w-3 h-3"></i><span>Terminal</span></div>
                <button onclick="closeWin('win-cmd')" class="hover:bg-red-600 px-2 text-white">✕</button>
            </div>
            <div class="p-4 text-xs h-full bg-black overflow-hidden font-mono">
                Microsoft Windows [Version 10.0.22621.1] <br>
                (c) Microsoft Corporation. All rights reserved. <br><br>
                C:\Users\JohnDoe> <span class="animate-pulse">_</span>
            </div>
            <div class="resizer" onmousedown="initResize(this.parentElement, event)"></div>
        </div>

        <div id="win-taskmgr" class="window no-blur" style="width: 550px; height: 500px;" data-app="taskmgr">
            <div class="win-titlebar bg-white dark:bg-zinc-800 p-3 flex justify-between items-center border-b border-black/5" onmousedown="dragElement(this.parentElement, event)">
                <div class="flex items-center gap-2 text-sm font-semibold"><i data-feather="activity" class="w-4 h-4 text-blue-600"></i><span>Task Manager</span></div>
                <button onclick="closeWin('win-taskmgr')" class="px-2">✕</button>
            </div>
            <div class="p-4 overflow-auto">
                <table class="w-full text-xs">
                    <thead class="text-left text-gray-400 border-b border-black/5">
                        <tr><th class="pb-2 font-normal">Process</th><th class="pb-2 font-normal text-right">CPU</th></tr>
                    </thead>
                    <tbody id="task-list"></tbody>
                </table>
            </div>
            <div class="resizer" onmousedown="initResize(this.parentElement, event)"></div>
        </div>

        <div id="win-run" class="window no-blur" style="width: 400px; height: auto;" data-app="run">
            <div class="win-titlebar bg-gray-50 dark:bg-zinc-800 p-2 flex justify-between items-center border-b border-black/5" onmousedown="dragElement(this.parentElement, event)">
                <div class="flex items-center gap-2 text-[10px] font-bold uppercase text-gray-400 tracking-tighter">Run</div>
                <button onclick="closeWin('win-run')" class="px-2">✕</button>
            </div>
            <div class="p-5 space-y-4">
                <div class="flex gap-4">
                    <i data-feather="play" class="w-8 h-8 text-blue-500"></i>
                    <p class="text-xs">Type the name of a program to open.</p>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs">Open:</span>
                    <input type="text" id="runInput" class="flex-grow border p-1 text-xs outline-none focus:border-blue-500 dark:bg-zinc-700 dark:border-zinc-600">
                </div>
                <div class="flex justify-end gap-2">
                    <button onclick="executeRun()" class="bg-gray-200 dark:bg-zinc-700 px-6 py-1 text-xs rounded hover:bg-gray-300">OK</button>
                    <button onclick="closeWin('win-run')" class="bg-white dark:bg-zinc-600 border border-black/10 px-4 py-1 text-xs rounded">Cancel</button>
                </div>
            </div>
        </div>

        <div class="taskbar" id="sys-taskbar">
            <div class="flex items-center gap-1" id="taskbar-icons">
                <div class="taskbar-btn" onclick="toggleStart()"><img src="https://upload.wikimedia.org/wikipedia/commons/8/87/Windows_logo_-_2021.svg" width="20"></div>
                <div class="taskbar-btn" id="task-browser" onclick="openApp('browser')"><i data-feather="globe" size="18" class="text-blue-500"></i></div>
                <div class="taskbar-btn" id="task-wikipedia" onclick="openApp('wikipedia')"><i data-feather="book-open" size="18" class="text-zinc-500"></i></div>
                <div class="taskbar-btn" id="task-settings" onclick="openApp('settings')"><i data-feather="settings" size="18" class="text-zinc-500"></i></div>
                <div class="taskbar-btn" id="task-wellbeing" onclick="openApp('wellbeing')"><i data-feather="heart" size="18" class="text-pink-400"></i></div>
                <div class="taskbar-btn" id="task-cmd" onclick="openApp('cmd')"><i data-feather="terminal" size="18" class="text-zinc-400"></i></div>
                <div class="taskbar-btn" id="task-taskmgr" onclick="openApp('taskmgr')"><i data-feather="activity" size="18" class="text-green-600"></i></div>
            </div>
            <div class="taskbar-right text-[10px] text-right font-medium text-gray-700 dark:text-gray-300">
                <div id="clock-time">12:00 PM</div>
                <div id="clock-date">12/23/2025</div>
            </div>
        </div>
    </div>

    <script>
        feather.replace();
        let openApps = new Set();
        let config = { transparency: true, alignment: 'center', theme: 'light' };

        function dragElement(elmnt, e) {
            if (e.target.closest('button') || e.target.closest('input') || e.target.closest('.resizer')) return;
            const rect = elmnt.getBoundingClientRect();
            let offsetX = e.clientX - rect.left;
            let offsetY = e.clientY - rect.top;
            
            function move(ev) {
                elmnt.style.top = (ev.clientY - offsetY) + "px";
                elmnt.style.left = (ev.clientX - offsetX) + "px";
                elmnt.style.transform = "none";
                elmnt.style.transition = "none";
                elmnt.querySelectorAll('iframe').forEach(f => f.style.pointerEvents = 'none');
            }
            
            function stop() {
                document.removeEventListener('mousemove', move);
                document.removeEventListener('mouseup', stop);
                elmnt.style.transition = "transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1), opacity 0.2s ease-out";
                elmnt.querySelectorAll('iframe').forEach(f => f.style.pointerEvents = 'auto');
            }
            
            document.addEventListener('mousemove', move);
            document.addEventListener('mouseup', stop);
        }

        function initResize(elmnt, e) {
            e.preventDefault();
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = parseInt(elmnt.style.width, 10);
            const startHeight = parseInt(elmnt.style.height, 10);

            function resize(ev) {
                elmnt.style.width = (startWidth + ev.clientX - startX) + 'px';
                elmnt.style.height = (startHeight + ev.clientY - startY) + 'px';
                elmnt.style.transition = "none";
                elmnt.querySelectorAll('iframe').forEach(f => f.style.pointerEvents = 'none');
            }

            function stop() {
                document.removeEventListener('mousemove', resize);
                document.removeEventListener('mouseup', stop);
                elmnt.style.transition = "transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1), opacity 0.2s ease-out";
                elmnt.querySelectorAll('iframe').forEach(f => f.style.pointerEvents = 'auto');
            }

            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', stop);
        }

        function openApp(id) {
            const win = document.getElementById(`win-${id}`);
            if (!win) return;
            win.style.display = 'flex';
            if (!win.style.top) {
                win.style.top = '10%';
                win.style.left = '15%';
            }
            setTimeout(() => win.classList.add('active'), 10);
            openApps.add(id);
            document.getElementById(`task-${id}`)?.classList.add('open');
            updateTaskManager();
        }

        function closeWin(id) {
            const win = document.getElementById(id);
            win.classList.remove('active');
            const appId = id.replace('win-', '');
            openApps.delete(appId);
            document.getElementById(`task-${appId}`)?.classList.remove('open');
            setTimeout(() => { if(!win.classList.contains('active')) win.style.display = 'none'; }, 400);
            updateTaskManager();
        }

        function toggleStart() {
            const menu = document.getElementById('start-menu');
            if (menu.classList.contains('active')) {
                menu.classList.remove('active');
                document.getElementById('user-dropdown').classList.remove('active');
                setTimeout(() => { if(!menu.classList.contains('active')) menu.style.display = 'none'; }, 400);
            } else {
                menu.style.display = 'flex';
                setTimeout(() => menu.classList.add('active'), 10);
            }
        }

        function toggleUserDropdown(e) {
            if (e) e.stopPropagation();
            const dropdown = document.getElementById('user-dropdown');
            if (dropdown.classList.contains('active')) {
                dropdown.classList.remove('active');
                setTimeout(() => { if(!dropdown.classList.contains('active')) dropdown.style.display = 'none'; }, 200);
            } else {
                dropdown.style.display = 'block';
                setTimeout(() => dropdown.classList.add('active'), 10);
            }
        }

        function handleLogout() {
            toggleUserDropdown();
            showError("This action has been blocked by your administrator.");
        }

        function toggleParam(p) {
            if (p === 'transparency') {
                config.transparency = !config.transparency;
                document.getElementById('param-transparency').classList.toggle('on');
                applyTransparency();
            } else if (p === 'alignment') {
                config.alignment = config.alignment === 'center' ? 'left' : 'center';
                document.getElementById('param-alignment').innerText = config.alignment === 'center' ? 'Center' : 'Left';
                document.getElementById('sys-taskbar').classList.toggle('left-aligned');
            }
        }

        function applyTransparency() {
            document.querySelectorAll('.window:not(.no-blur)').forEach(w => {
                w.style.backdropFilter = config.transparency ? 'blur(20px)' : 'none';
                w.style.background = config.transparency ? (config.theme === 'dark' ? 'rgba(32, 32, 32, 0.9)' : 'rgba(255, 255, 255, 0.9)') : (config.theme === 'dark' ? '#202020' : '#ffffff');
            });
            document.getElementById('start-menu').style.backdropFilter = config.transparency ? 'blur(30px)' : 'none';
        }

        function updateTaskManager() {
            const list = document.getElementById('task-list');
            list.innerHTML = '';
            ['System', ...openApps].forEach(app => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-black/5 hover:bg-black/5";
                tr.innerHTML = `<td class="py-2">${app}</td><td class="text-right text-blue-600">${Math.floor(Math.random()*5)}%</td>`;
                list.appendChild(tr);
            });
        }

        function executeRun() {
            const cmd = document.getElementById('runInput').value.toLowerCase();
            const valid = ['settings', 'cmd', 'taskmgr', 'browser', 'wikipedia', 'wellbeing'];
            if (valid.includes(cmd)) {
                openApp(cmd);
                closeWin('win-run');
            } else {
                showError();
            }
        }

        function handleUrlGo(e, frameId) {
            if (e.key === 'Enter') {
                let url = e.target.value;
                if (!url.trim()) {
                    showBrowserHome();
                    return;
                }
                if (!url.includes('.') || url.includes(' ')) {
                    url = 'https://www.google.com/search?q=' + encodeURIComponent(url) + '&igu=1';
                } else if (!url.startsWith('http')) {
                    url = 'https://' + url;
                }
                
                document.getElementById(frameId).src = url;
                document.getElementById(frameId).classList.remove('hidden');
                document.getElementById('browser-home').classList.add('hidden');
                document.getElementById('browser-url').value = url;
            }
        }

        function showBrowserHome() {
            document.getElementById('browser-frame').classList.add('hidden');
            document.getElementById('browser-home').classList.remove('hidden');
            document.getElementById('browser-url').value = "";
        }

        function refreshIframe(id) {
            const iframe = document.getElementById(id);
            if (!iframe.classList.contains('hidden')) iframe.src = iframe.src;
        }

        function showSecurity() {
            const menu = document.getElementById('security-menu');
            menu.style.display = 'flex';
            setTimeout(() => menu.classList.add('active'), 10);
        }

        function closeSecurity() {
            const menu = document.getElementById('security-menu');
            menu.classList.remove('active');
            setTimeout(() => { if(!menu.classList.contains('active')) menu.style.display = 'none'; }, 500);
        }

        function handleSecurityAction() {
            showError("This action has been blocked by your administrator.");
        }

        function showError(msg) {
            const d = document.getElementById('error-dialog');
            const messageEl = document.getElementById('error-message');
            messageEl.innerText = msg || "This action has been blocked by your administrator.";
            d.style.display = 'flex';
            setTimeout(() => {
                document.getElementById('error-box').style.opacity = '1';
                document.getElementById('error-box').style.transform = 'scale(1)';
            }, 10);
        }

        function closeError() {
            document.getElementById('error-box').style.opacity = '0';
            document.getElementById('error-box').style.transform = 'scale(0.9)';
            setTimeout(() => document.getElementById('error-dialog').style.display = 'none', 300);
        }

        function handleDesktopClick(e) {
            if (!e.target.closest('#start-menu') && !e.target.closest('.taskbar-btn') && !e.target.closest('#user-dropdown')) {
                if (document.getElementById('start-menu').classList.contains('active')) toggleStart();
                if (document.getElementById('user-dropdown').classList.contains('active')) toggleUserDropdown();
            }
        }

        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            
            if (params.get('theme') === 'dark') {
                config.theme = 'dark';
                document.getElementById('main-desktop').classList.add('dark-mode');
                applyTransparency();
            }

            if (params.get('align') === 'left') {
                toggleParam('alignment');
            }

            if (params.get('page') === 'ctrl+alt+del') {
                showSecurity();
            }

            const appToOpen = params.get('app');
            if (appToOpen) {
                setTimeout(() => openApp(appToOpen), 500);
            }
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'r' && (e.metaKey || e.ctrlKey)) {
                e.preventDefault();
                openApp('run');
            }
            if (e.key === 'Delete' && e.ctrlKey && e.altKey) {
                e.preventDefault();
                showSecurity();
            }
        });

        setInterval(() => {
            const now = new Date();
            document.getElementById('clock-time').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('clock-date').innerText = now.toLocaleDateString();
        }, 1000);

        window.onload = () => {
            checkUrlParams();
            updateTaskManager();
        };
    </script>
</body>
</html>
